# ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

## ğŸ—ï¸ è¨­è¨ˆåŸå‰‡

ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä»¥ä¸‹ã®åŸå‰‡ã«åŸºã¥ã„ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ï¼š

### 1. ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•å‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®é€šä¿¡ã‚’ **EventBus** çµŒç”±ã§è¡Œã†ã“ã¨ã§ã€ç–çµåˆã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

**ãƒ¡ãƒªãƒƒãƒˆï¼š**
- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒäº’ã„ã‚’ç›´æ¥çŸ¥ã‚‹å¿…è¦ãŒãªã„
- æ–°ã—ã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¿½åŠ ãŒå®¹æ˜“
- ãƒ†ã‚¹ãƒˆãŒæ›¸ãã‚„ã™ã„
- å¤‰æ›´ã®å½±éŸ¿ç¯„å›²ãŒé™å®šçš„

**ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š** Observer ãƒ‘ã‚¿ãƒ¼ãƒ³ (EventEmitter)

### ä¾‹ï¼š**å˜ä¸€è²¬ä»»ã®åŸå‰‡ (SRP)**

å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯1ã¤ã®æ˜ç¢ºãªå½¹å‰²ã®ã¿ã‚’æŒã¡ã¾ã™ã€‚

**ä¾‹ï¼š**
- `PDFRenderer` â†’ PDFã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ã¿
- `NavigationManager` â†’ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®ã¿
- `VideoModalManager` â†’ å‹•ç”»ãƒ¢ãƒ¼ãƒ€ãƒ«ã®é–‹é–‰ã®ã¿
- `TableOfContentsManager` â†’ ç›®æ¬¡ãƒ¢ãƒ¼ãƒ€ãƒ«ã®é–‹é–‰ã®ã¿
- `TimerManager` â†’ ã‚¿ã‚¤ãƒãƒ¼ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ç®¡ç†ã®ã¿
- `PrintManager` â†’ PDFå°åˆ·æ©Ÿèƒ½ã®ã¿

### 3. çŠ¶æ…‹ç®¡ç†ã®ä¸€å…ƒåŒ–

`AppState` ã‚¯ãƒ©ã‚¹ã§ã™ã¹ã¦ã®ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ç®¡ç†ã—ã¾ã™ã€‚

**ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š** Facade ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆè¤‡é›‘ãªã‚µãƒ–ã‚·ã‚¹ãƒ†ãƒ ã‚’å˜ç´”ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§æä¾›ï¼‰

### 4. ä¾å­˜æ€§ã®æ³¨å…¥

å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯å¿…è¦ãªä¾å­˜ã‚’å¤–éƒ¨ã‹ã‚‰æ³¨å…¥ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å†åˆ©ç”¨æ€§ã¨ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ãŒå‘ä¸Šã—ã¾ã™ã€‚

```javascript
// ä¾å­˜ã‚’å¤–éƒ¨ã‹ã‚‰æ³¨å…¥
new AnnotationManager(annotationLayer, eventBus);
new ModalManager(eventBus);
```

**ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š** Dependency Injection

### ãªãœã“ã®è¨­è¨ˆï¼Ÿ

ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•å‹ã‚’æ¡ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã¯èª°ãŒãƒªã‚¹ãƒŠãƒ¼ã‹çŸ¥ã‚‹å¿…è¦ãŒãªãã€ãƒªã‚¹ãƒŠãƒ¼ã®è¿½åŠ ãƒ»å‰Šé™¤ãŒæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã«å½±éŸ¿ã—ã¾ã›ã‚“ã€‚å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆå¯èƒ½ã«ãªã‚Šã€æ–°æ©Ÿèƒ½ã®è¿½åŠ ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚

### ã“ã®è¨­è¨ˆãŒã‚‚ãŸã‚‰ã™åˆ©ç‚¹

- **ä¿å®ˆæ€§** - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒç‹¬ç«‹ã—ã€å¤‰æ›´ã®å½±éŸ¿ç¯„å›²ãŒæ˜ç¢º
- **æ‹¡å¼µæ€§** - ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚ˆã†ã«æ–°æ©Ÿèƒ½ã‚’è¿½åŠ å¯èƒ½
- **ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£** - å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆå¯èƒ½
- **ãƒãƒ¼ãƒ é–‹ç™º** - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ä½ã§ä½œæ¥­ã‚’åˆ†æ‹…ã§ãã‚‹

---

## ğŸ“Š ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
pdf-slide-viewer/
â”œâ”€â”€ src/                        # é–‹ç™ºç”¨ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ main.js                 # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ styles.css              # ã‚¹ã‚¿ã‚¤ãƒ«
â”‚   â”œâ”€â”€ index.html              # HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â””â”€â”€ modules/                # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¾¤
â”‚       â”œâ”€â”€ app-state.js        # çŠ¶æ…‹ç®¡ç†
â”‚       â”œâ”€â”€ event-emitter.js    # ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¹
â”‚       â”œâ”€â”€ config.js           # è¨­å®šç®¡ç†
â”‚       â”œâ”€â”€ pdf-renderer.js     # PDFãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
â”‚       â”œâ”€â”€ annotation.js       # ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†
â”‚       â”œâ”€â”€ video-modal.js      # å‹•ç”»ãƒ¢ãƒ¼ãƒ€ãƒ«
â”‚       â”œâ”€â”€ video-button.js     # å‹•ç”»ãƒœã‚¿ãƒ³
â”‚       â”œâ”€â”€ slide-button.js     # ã‚¹ãƒ©ã‚¤ãƒ‰ãƒªãƒ³ã‚¯ãƒœã‚¿ãƒ³
â”‚       â”œâ”€â”€ table-of-contents.js # ç›®æ¬¡ãƒ¢ãƒ¼ãƒ€ãƒ«
â”‚       â”œâ”€â”€ navigation.js       # ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
â”‚       â”œâ”€â”€ timer.js            # ã‚¿ã‚¤ãƒãƒ¼
â”‚       â””â”€â”€ print.js            # å°åˆ·
â”œâ”€â”€ public/                     # é–‹ç™ºç’°å¢ƒç”¨å…¬é–‹ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ lib/pdfjs/              # PDF.jsãƒ©ã‚¤ãƒ–ãƒ©ãƒª
â”‚   â”œâ”€â”€ sample-timer/           # ã‚¿ã‚¤ãƒãƒ¼ã‚¢ãƒ—ãƒª
â”‚   â””â”€â”€ slides/                 # é–‹ç™ºç”¨ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿
â”‚       â””â”€â”€ 001/
â”‚           â”œâ”€â”€ config.json
â”‚           â””â”€â”€ slide.pdf
â”œâ”€â”€ docs/                       # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ development.md
â”‚   â”œâ”€â”€ architecture.md
â”‚   â”œâ”€â”€ build-guide.md
â”‚   â””â”€â”€ creators-guide.md
â”œâ”€â”€ package.json
â””â”€â”€ vite.config.js              # Viteè¨­å®šï¼ˆãƒ“ãƒ«ãƒ‰è¨­å®šï¼‰
```

### ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Presentation Layer            â”‚  â† UI/DOMæ“ä½œ
â”‚  (Navigation, Modal, Annotation)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        Business Logic Layer          â”‚  â† ãƒ­ã‚¸ãƒƒã‚¯ãƒ»çŠ¶æ…‹ç®¡ç†
â”‚     (AppState, EventEmitter)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        Data Layer                    â”‚  â† ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
â”‚  (ConfigManager, PDFRenderer)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“é€šä¿¡

ã™ã¹ã¦ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“é€šä¿¡ã¯ **EventBus** ã‚’çµŒç”±ã—ã¾ã™ï¼š

```javascript
// ã‚¤ãƒ™ãƒ³ãƒˆçµŒç”±ã§é€šä¿¡
class AnnotationManager {
    constructor(annotationLayer, eventBus) {
        this.eventBus = eventBus;
        
        // å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ™ãƒ³ãƒˆã§å—ã‘å–ã‚‹
        this.eventBus.on('pageRendered', ({ annotations, displayScale }) => {
            this.annotations = annotations;
            this.displayScale = displayScale;
            this.render();
        });
    }
    
    handleClick(url) {
        // ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºè¡Œã™ã‚‹ã ã‘
        this.eventBus.emit('videoRequested', { url });
    }
}
```

**ãƒ¡ãƒªãƒƒãƒˆï¼š**
- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒç–çµåˆ
- ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“
- å¤‰æ›´ã®å½±éŸ¿ãŒé™å®šçš„
- æ–°æ©Ÿèƒ½è¿½åŠ ãŒç°¡å˜

---

## ğŸ¯ AppStateã®å½¹å‰²

`AppState` ã¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚

### è²¬å‹™

1. **ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†**
   - åˆæœŸåŒ–é †åºã®åˆ¶å¾¡
   - ä¾å­˜é–¢ä¿‚ã®è§£æ±º
   - ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

2. **ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¹ã®æä¾›**
   - å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å…±é€šã®EventBusã‚’æä¾›
   - ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼ã®èª¿æ•´

3. **åˆæœŸåŒ–ãƒ•ãƒ­ãƒ¼ã®åˆ¶å¾¡**
   ```
   1. PDF.jsèª­ã¿è¾¼ã¿å¾…æ©Ÿ
   2. ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼åˆæœŸåŒ–
   3. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
   4. PDFèª­ã¿è¾¼ã¿
   5. ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
   6. æœ€åˆã®ãƒšãƒ¼ã‚¸è¡¨ç¤º
   ```

4. **ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
   - ãƒšãƒ¼ã‚¸å¤‰æ›´
   - ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚º
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### å®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸

`AppState` ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹é€ ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã‚’çµ±æ‹¬ã—ã¾ã™ï¼š

```javascript
export class AppState {
    constructor(slideFolder) {
        // EventBusã‚’ä½œæˆã—ã€å…¨ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§å…±æœ‰
        this.eventBus = new EventEmitter();
    }

    async initialize() {
        // åˆæœŸåŒ–ã¯é †åºãŒé‡è¦ï¼š
        // 1. PDF.jsèª­ã¿è¾¼ã¿
        // 2. ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼åˆæœŸåŒ–ï¼ˆEventBusã‚’å„ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã«æ³¨å…¥ï¼‰
        // 3. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ»PDFèª­ã¿è¾¼ã¿
        // 4. ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šï¼ˆã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼ã®é…ç·šï¼‰
        // 5. æœ€åˆã®ãƒšãƒ¼ã‚¸è¡¨ç¤º
    }

    _setupEventListeners() {
        // AppStateã¯ã‚¤ãƒ™ãƒ³ãƒˆã®ã€Œäº¤é€šæ•´ç†å½¹ã€
        // å„ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‹ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ã‘å–ã‚Šã€
        // å¿…è¦ã«å¿œã˜ã¦ä»–ã®ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã«æŒ¯ã‚Šåˆ†ã‘ã‚‹
        this.eventBus.on('pageJumpRequested', ...);  // ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯æ™‚
        this.eventBus.on('pageRendered', ...);       // ãƒšãƒ¼ã‚¸æç”»å®Œäº†æ™‚
    }
}
```

**ãƒã‚¤ãƒ³ãƒˆï¼š**
- EventBusã¯å…¨ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã«æ³¨å…¥ã•ã‚Œã‚‹ã€Œå…±é€šã®é€šä¿¡è·¯ã€
- AppStateã¯ç›´æ¥çš„ãªå‡¦ç†ã‚’ã›ãšã€ã‚¤ãƒ™ãƒ³ãƒˆã®æµã‚Œã‚’èª¿æ•´ã™ã‚‹ã ã‘
- å„ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¯ç‹¬ç«‹ã—ã¦å‹•ä½œã—ã€EventBusçµŒç”±ã§ã®ã¿é€šä¿¡

---

## ğŸ”Œ EventEmitterã®ä»•çµ„ã¿

### åŸºæœ¬æ§‹é€ 

```javascript
export class EventEmitter {
    constructor() {
        this.events = {};  // { eventName: [listener1, listener2, ...] }
    }

    on(event, listener) {
        if (!this.events[event]) {
            this.events[event] = [];
        }
        this.events[event].push(listener);
    }

    emit(event, data) {
        if (!this.events[event]) return;
        this.events[event].forEach(listener => {
            try {
                listener(data);
            } catch (error) {
                console.error(`ã‚¤ãƒ™ãƒ³ãƒˆ "${event}" ã®ãƒªã‚¹ãƒŠãƒ¼ã§ã‚¨ãƒ©ãƒ¼:`, error);
            }
        });
    }
}
```

### ç‰¹å¾´

- **ã‚¨ãƒ©ãƒ¼åˆ†é›¢**: 1ã¤ã®ãƒªã‚¹ãƒŠãƒ¼ã®ã‚¨ãƒ©ãƒ¼ãŒä»–ã«å½±éŸ¿ã—ãªã„
- **éåŒæœŸå®‰å…¨**: try-catchã§ä¿è­·ã•ã‚Œã¦ã„ã‚‹
- **è¤‡æ•°è³¼èª­**: åŒã˜ã‚¤ãƒ™ãƒ³ãƒˆã«è¤‡æ•°ã®ãƒªã‚¹ãƒŠãƒ¼ã‚’ç™»éŒ²å¯èƒ½
- **ã‚·ãƒ³ãƒ—ãƒ«**: æœ€å°é™ã®æ©Ÿèƒ½ã§è»½é‡

---

## ğŸ“¦ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¾å­˜é–¢ä¿‚

### ä¾å­˜ã‚°ãƒ©ãƒ•

```
main.js
  â””â”€ AppState
       â”œâ”€ EventEmitter (ã‚³ã‚¢ä¾å­˜)
       â”œâ”€ ConfigManager
       â”œâ”€ PDFRenderer
       â”œâ”€ AnnotationManager
       â”‚    â””â”€ EventEmitter
       â”œâ”€ VideoButtonManager
       â”‚    â””â”€ EventEmitter
       â”œâ”€ VideoModalManager
       â”‚    â””â”€ EventEmitter
       â”œâ”€ SlideButtonManager
       â”‚    â””â”€ EventEmitter
       â”œâ”€ TableOfContentsManager
       â”‚    â””â”€ EventEmitter
       â”œâ”€ TimerManager
       â”‚    â””â”€ EventEmitter
       â”œâ”€ PrintManager
       â”‚    â””â”€ EventEmitter
       â””â”€ NavigationManager
            â””â”€ Callbacké–¢æ•°
```

### ä¾å­˜ã®ãƒ«ãƒ¼ãƒ«

1. **EventBusã¸ã®ä¾å­˜ã¯OK**
   - ã™ã¹ã¦ã®ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒEventBusã«ä¾å­˜ã—ã¦ã‚ˆã„
   - ä¸­æ ¸çš„ãªé€šä¿¡æ‰‹æ®µ

2. **ä»–ã®ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¸ã®ç›´æ¥ä¾å­˜ã¯NG**
   - ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼åŒå£«ã¯ç›´æ¥å‚ç…§ã—ãªã„
   - ã‚¤ãƒ™ãƒ³ãƒˆçµŒç”±ã§é€šä¿¡

3. **DOMã¸ã®ç›´æ¥ä¾å­˜ã¯OK**
   - UIãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¯DOMè¦ç´ ã‚’ç›´æ¥æ“ä½œã—ã¦ã‚ˆã„

4. **å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¸ã®ä¾å­˜**
   - PDFRenderer â†’ PDF.js
   - ãã®ä»–ã¯æ¨™æº–APIã®ã¿

---

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### ãƒšãƒ¼ã‚¸ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ãƒ•ãƒ­ãƒ¼

```
User Action (ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³)
    â†“
NavigationManager.goToPage(pageNum)
    â†“
onPageChange ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
    â†“
AppState._onPageChange(pageNum)
    â†“
PDFRenderer.renderPage(pageNum)
    â†“
Canvasæç”» + ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æŠ½å‡º
    â†“
return { annotations, ... }
    â†“
emit('pageRendered', { pageNum, annotations, displayScale, pdfDoc })
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚              â”‚              â”‚
â–¼              â–¼              â–¼              â–¼
Annotation   Video         AppState      Navigation
Manager      Button        (å‹•ç”»æº–å‚™)     Manager
(è‡ªå‹•render) Manager                      (UIæ›´æ–°)
             (è‡ªå‹•render)
```

### ã‚¤ãƒ™ãƒ³ãƒˆã®æµã‚Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼  â”‚ emit('eventName', data)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EventBus   â”‚ ãƒªã‚¹ãƒŠãƒ¼ãƒªã‚¹ãƒˆã‚’å–å¾—
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚             â”‚
       â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ã‚µãƒ–ã‚¹ã‚¯ãƒ©ã‚¤ãƒãƒ¼Aâ”‚  â”‚ã‚µãƒ–ã‚¹ã‚¯ãƒ©ã‚¤ãƒãƒ¼Bâ”‚ on('eventName', handler)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© æ‹¡å¼µæ€§

### æ–°ã—ã„ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®è¿½åŠ 

ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•å‹ãªã®ã§ã€æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã›ãšã«æ–°æ©Ÿèƒ½ã‚’è¿½åŠ ã§ãã¾ã™ï¼š

```javascript
// æ–°ã—ã„ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
export class AnalyticsManager {
    constructor(eventBus) {
        this.eventBus = eventBus;
        this.pageViews = new Map();
        
        // æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆã‚’è³¼èª­ã™ã‚‹ã ã‘
        this.eventBus.on('pageRendered', ({ pageNum }) => {
            this.trackPageView(pageNum);
        });
    }
    
    trackPageView(pageNum) {
        const count = this.pageViews.get(pageNum) || 0;
        this.pageViews.set(pageNum, count + 1);
    }
}
```

```javascript
// AppState ã«è¿½åŠ ã™ã‚‹ã ã‘
_initializeManagers() {
    // æ—¢å­˜ã®ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼...
    
    // æ–°ã—ã„ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’è¿½åŠ 
    this.analyticsManager = new AnalyticsManager(this.eventBus);
}
```

**ãƒã‚¤ãƒ³ãƒˆï¼š**
- æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒãªã„
- æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãã®ã¾ã¾åˆ©ç”¨ã§ãã‚‹
- ç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆå¯èƒ½

---

##  å‚è€ƒè³‡æ–™

- [Event-Driven Architecture](https://martinfowler.com/articles/201701-event-driven.html)
- [Observer Pattern](https://refactoring.guru/design-patterns/observer)
- [Dependency Injection](https://en.wikipedia.org/wiki/Dependency_injection)
